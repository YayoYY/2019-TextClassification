# 文本分类智能量刑

本项目来源于“新华三杯大连地区高校大数据竞赛”中的限选题第一题。选手需根据案情事实，预测嫌疑人的罪名信息。本次任务选取案件类型较多的TOP30作为罪名空间，每个案情事实可能对应多项罪名。因此，这是一个文本多标签分类任务。

本项目使用传统机器学习和深度学习两种方法。

传统机器学习方法：

- 特征工程：分词特征、ngram特征、tf-idf特征权重计算、特征选择
- 模型：逻辑回归、SVM、KNN、朴素贝叶斯、决策树和LightGBM
- 多标签分类策略：OVR策略
- 语义级别文本表示方法：LDA、LSA、PLSA等

深度学习方法：

- 词向量：fasttext、word2vec等
- 模型：TextCNN、TextRNN、TextCRNN、HAN、DPCNN等
- 欲训练模型：BERT等

## 数据集

原始数据集链接：https://pan.baidu.com/s/12IESi6s50649-jtyPQo3Cw 提取码：bfxu 
	
原始数据集大小为：(357454, 5)

数据字段描述：

字段|	含义|	格式
---|---|---
ids|	案件id信息，由案件正文内容计算hash得到|str
fact|案件对应的案情事实|	str
criminal|需要进行罪名预测和法律条文预测的目标嫌疑人|str
accusation|指控信息，即嫌疑人涉及的罪名信息|str
articles|嫌疑人涉及到的法律条文编号|	str

类别：

	labels = ['交通肇事', '信用卡诈骗' ,'危险驾驶', '受贿' ,'合同诈骗', '妨害公务', '容留他人吸毒' ,
			'寻衅滋事','开设赌场','引诱、容留、介绍卖淫', '抢劫', '抢夺', '掩饰、隐瞒犯罪所得、犯罪所得收益', 
			'故意伤害', '故意杀人', '故意毁坏财物', '敲诈勒索', '滥伐林木' ,'生产、销售假药', '盗窃', 
			'组织、强迫、引诱、容留、介绍卖淫', '职务侵占','诈骗' ,'贪污', '赌博','走私、贩卖、运输、制造毒品',
			'过失致人死亡' ,'非法拘禁', '非法持有、私藏枪支、弹药' ,'非法持有毒品']

由于算力限制，本项目从原始数据集中提取出10%的数据进行实验。其中训练集为90%（数据量为 32171），测试集10%（数据量为 3575）。数据的划分过程在[dataset.py](code/dataset.py)文件中。

另外在[dataset.py](code/dataset.py)文件中还对多标签进行了one-hot的编码处理。通过对标签进行统计得知数据集中存在类别不平衡的问题，这也是本次任务即将面临和解决的重难点。

[preprocessing.py](code/preprocessing.py)中对fact字段进行了分词和去停用词处理，以便后续计算分词特征的tf-idf权重。

## 评估指标

每个案情事实可能对应多项罪名，因此评价指标使用宏平均的F1与微平均的F1值加权的方式给出：

$F1_{macro}=\frac{2*P_{macro}*R_{macro}}{P_{macro}+R_{macro}}$

$P_{macro}=\frac{\sum_{i=i}^{K}P_{i}}{K}\ \ \ \ R_{macro}=\frac{\sum_{i=i}^{K}R_{i}}{K}$

$F1_{micro}=\frac{2*P_{micro}*R_{macro}}{P_{macro}+R_{macro}}$

$P_{micro}=\frac{\sum_{i}^{K}TP_i}{\sum_{i}^{K}TP_i+\sum_{i}^{K}FP_i}\ \ \ \ R_{micro}=\frac{\sum_{i}^{K}TP_i}{\sum_{i}^{K}TP_i+\sum_{i}^{K}FN_i}$
	
此外 ，在实验过程中还输出了分类报告来观察对模型对各个不同标签的分类结果。

## 实验结果

### 传统机器学习

**2019-11-23 [实验结果](result/2019-11-23.txt)**

分词特征     max\_df=0.8     chi2     dim=500

| 模型        | 训练时间    | 预测时间  | 宏微F1平均值 | 宏P  | 宏R  |
| ----------- | ----------- | --------- | ------------ | ---- | ---- |
| 逻辑回归    | 220.9116s   | 0.186s    | 0.8016       | 0.92 | 0.88 |
| SVM         | 15434.0258s | 217.8805s | 0.8489       | 0.87 | 0.92 |
| KNN         | 361.3657s   | 662.2899s | 0.8281       | 0.87 | 0.91 |
| 朴素贝叶斯 | 31.7358s    | 2.6512s   | 0.2973       | 0.46 | 0.96 |
| 决策树      | 19.2371s    | 0.411s    | 0.8149       | 0.89 | 0.89 |
| LightGBM    | 177.8342s   | 2.1941s   | 0.8924       | 0.94 | 0.95 |

二字串     max\_df=0.8     chi2     dim=500

| 模型        | 训练时间    | 预测时间  | 宏微F1平均值 | 宏P  | 宏R  |
| ----------- | ----------- | --------- | ------ | ---- | ---- |
| 逻辑回归    | 208.6609s   | 0.195s    | 0.7691 | 0.9  | 0.87 |
| SVM         | 15283.3852s | 219.9096s | 0.819  | 0.85 | 0.91 |
| KNN         | 371.3372s   | 685.4312s | 0.8141 | 0.86 | 0.91 |
| 朴素贝叶斯 | 34.412s     | 2.6151s   | 0.321  | 0.5  | 0.96 |
| 决策树      | 24.8984s    | 0.299s    | 0.7958 | 0.88 | 0.88 |
| LightGBM    | 215.0643s   | 2.0571s   | 0.8877 | 0.94 | 0.94 |



### 深度学习方法

## 环境

- python 3.6.5
-  numpy 1.16.4
- pandas 0.24.2
- sklearn 0.21.2
- lightgbm 2.2.4
- jieba0.39
	



